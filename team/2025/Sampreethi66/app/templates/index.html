<p>
  ðŸ’¡ <a href="https://github.com/ModelEarth/projects/issues/36" target="_blank">
  View related GitHub Issue #36</a>
</p>

<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>CS Job Density â€“ Flask</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body class="p-4">
  <h2>CS Job Density (county) â€“ Flask preview</h2>

  <div class="mb-3">
    <label class="form-label">State FIPS</label>
    <select id="stateSelect" class="form-select form-select-sm" style="max-width: 240px">
      <option value="">All</option>
      {% for s in states %}
        <option value="{{ s }}">{{ s }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="mb-3">
    <label class="form-label">County FIPS</label>
    <input id="countyInput" class="form-control form-control-sm" placeholder="e.g. 48113 (Dallas) " style="max-width: 240px">
  </div>

  <button id="runBtn" class="btn btn-primary btn-sm">Load</button>

  <hr>
  <h5>Top rows (static preview)</h5>
  <div class="table-responsive">
    {{ table|safe }}
  </div>

  <hr>
  <h5>Filtered results (API)</h5>
  <table id="tbl" class="table table-sm table-striped">
    <thead></thead>
    <tbody></tbody>
  </table>

<script>
async function loadData() {
  const state = document.getElementById('stateSelect').value.trim();
  const county = document.getElementById('countyInput').value.trim();

  const params = new URLSearchParams();
  if (state) params.set('state_fips', state);
  if (county) params.set('county_fips', county);
  params.set('top','100');

  const res = await fetch('/api/density?' + params.toString());
  const rows = await res.json();

  const thead = document.querySelector('#tbl thead');
  const tbody = document.querySelector('#tbl tbody');
  thead.innerHTML = ''; tbody.innerHTML = '';

  if (!rows.length) { thead.innerHTML = '<tr><th>No results</th></tr>'; return; }

  const cols = Object.keys(rows[0]);
  thead.innerHTML = '<tr>' + cols.map(c => `<th>${c}</th>`).join('') + '</tr>';

  rows.forEach(r => {
    const tr = document.createElement('tr');
    tr.innerHTML = cols.map(c => `<td>${r[c] ?? ''}</td>`).join('');
    tbody.appendChild(tr);
  });
}
document.getElementById('runBtn').addEventListener('click', loadData);
</script>
</body>
</html>
